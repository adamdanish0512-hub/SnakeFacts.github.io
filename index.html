<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science Year 1 - Science Room Rules Learning Game</title>
    <style>
/* ===================================
   GLOBAL STYLES & RESET
   =================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
    position: relative;
    overflow-x: hidden;
}

/* ===================================
   ANIMATED BACKGROUND
   =================================== */
.background-particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 50%, rgba(76, 175, 80, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(33, 150, 243, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(255, 193, 7, 0.08) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
    animation: particleFloat 20s ease-in-out infinite;
}

@keyframes particleFloat {
    0%, 100% { transform: translate(0, 0) scale(1); }
    50% { transform: translate(20px, 20px) scale(1.05); }
}

/* ===================================
   CONTAINER & SCREEN MANAGEMENT
   =================================== */
.container {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 1400px;
    padding: 20px;
}

.screen {
    display: none;
    background: white;
    border-radius: 24px;
    padding: 40px;
    box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 100px rgba(76, 175, 80, 0.1);
    animation: fadeIn 0.5s ease-out;
}

.screen.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ===================================
   START SCREEN STYLES
   =================================== */
#startScreen {
    max-width: 900px;
    margin: 0 auto;
    text-align: center;
}

.logo-animation {
    font-size: 80px;
    animation: bounce 2s ease-in-out infinite;
    margin-bottom: 20px;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-20px); }
}

#startScreen h1 {
    font-size: 48px;
    background: linear-gradient(135deg, #4caf50 0%, #2196f3 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    font-weight: 800;
}

#startScreen h2 {
    color: #2c5364;
    font-size: 24px;
    margin-bottom: 10px;
    font-weight: 600;
}

.subtitle {
    color: #666;
    font-size: 18px;
    margin-bottom: 30px;
}

/* ===================================
   TOPIC SHOWCASE
   =================================== */
.topic-showcase {
    background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
    border-radius: 20px;
    padding: 30px;
    margin: 30px 0;
    border: 3px solid #4caf50;
}

.showcase-header h3 {
    color: #2e7d32;
    font-size: 22px;
    margin-bottom: 20px;
}

.learning-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.learning-card {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.learning-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(76, 175, 80, 0.3);
}

.card-icon {
    font-size: 40px;
    margin-bottom: 10px;
}

.learning-card h4 {
    color: #2e7d32;
    font-size: 18px;
    margin-bottom: 10px;
}

.learning-card p {
    color: #666;
    font-size: 14px;
    line-height: 1.5;
}

/* ===================================
   GAME INSTRUCTIONS
   =================================== */
.game-instructions {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    border-radius: 20px;
    padding: 30px;
    margin: 30px 0;
    border: 3px solid #ff9800;
}

.game-instructions h3 {
    color: #e65100;
    font-size: 22px;
    margin-bottom: 20px;
}

.instruction-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.instruction-item {
    background: white;
    padding: 20px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.step-number {
    background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%);
    color: white;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 20px;
    flex-shrink: 0;
}

.instruction-item p {
    color: #333;
    font-size: 14px;
    line-height: 1.4;
    text-align: left;
}

kbd {
    background: #333;
    color: white;
    padding: 4px 8px;
    border-radius: 5px;
    font-family: monospace;
    font-size: 12px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

/* ===================================
   BUTTONS
   =================================== */
.start-btn, .play-again-btn, .share-btn, .next-question-btn {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    color: white;
    border: none;
    padding: 18px 50px;
    font-size: 20px;
    font-weight: 700;
    border-radius: 50px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
    margin: 20px 10px;
    position: relative;
    overflow: hidden;
}

.start-btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

.start-btn:hover::before {
    width: 300px;
    height: 300px;
}

.start-btn:hover, .play-again-btn:hover, .next-question-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);
}

.start-btn:active {
    transform: translateY(0);
}

.pulse {
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

.share-btn {
    background: linear-gradient(135deg, #2196f3 0%, #1565c0 100%);
    box-shadow: 0 6px 20px rgba(33, 150, 243, 0.4);
}

.share-btn:hover {
    box-shadow: 0 10px 30px rgba(33, 150, 243, 0.5);
}

/* ===================================
   DIFFICULTY SELECTOR
   =================================== */
.difficulty-selector {
    margin-top: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    flex-wrap: wrap;
}

.difficulty-selector label {
    font-weight: 600;
    color: #333;
    font-size: 16px;
}

.diff-btn {
    background: #f5f5f5;
    color: #333;
    border: 2px solid #ddd;
    padding: 10px 20px;
    font-size: 16px;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.diff-btn:hover {
    background: #e0e0e0;
    border-color: #999;
}

.diff-btn.active {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    color: white;
    border-color: #4caf50;
}

/* ===================================
   GAME SCREEN LAYOUT
   =================================== */
#gameScreen {
    max-width: 1400px;
    padding: 30px;
}

.game-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
}

.stage-badge {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    color: white;
    padding: 15px 30px;
    border-radius: 50px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 700;
    font-size: 18px;
    box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
}

.stage-icon {
    font-size: 24px;
}

/* ===================================
   GAME STATS
   =================================== */
.game-stats {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.stat-item {
    background: white;
    border: 3px solid #e0e0e0;
    padding: 12px 20px;
    border-radius: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.stat-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
}

.stat-icon {
    font-size: 24px;
}

.stat-content {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.stat-label {
    font-size: 11px;
    color: #666;
    font-weight: 600;
    text-transform: uppercase;
}

.stat-value {
    font-size: 20px;
    font-weight: 700;
    color: #333;
}

.score-stat {
    border-color: #4caf50;
}

.time-stat {
    border-color: #2196f3;
}

.stars-stat {
    border-color: #ffc107;
}

.music-toggle {
    background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
    color: white;
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    font-size: 24px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 3px 10px rgba(156, 39, 176, 0.3);
}

.music-toggle:hover {
    transform: scale(1.1) rotate(15deg);
    box-shadow: 0 5px 15px rgba(156, 39, 176, 0.5);
}

/* ===================================
   GAME CONTENT LAYOUT
   =================================== */
.game-content {
    display: grid;
    grid-template-columns: auto 350px;
    gap: 30px;
}

@media (max-width: 1200px) {
    .game-content {
        grid-template-columns: 1fr;
    }
}

.canvas-container {
    position: relative;
}

#canvas {
    border: 5px solid #2c5364;
    border-radius: 20px;
    box-shadow: 
        0 10px 40px rgba(0, 0, 0, 0.2),
        inset 0 0 30px rgba(76, 175, 80, 0.1);
    display: block;
    width: 100%;
    max-width: 600px;
    height: auto;
}

.combo-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 48px;
    font-weight: 900;
    color: #ff9800;
    text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.5);
    display: none;
    animation: comboPopup 1s ease-out;
    pointer-events: none;
}

@keyframes comboPopup {
    0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
}

/* ===================================
   INFO PANEL
   =================================== */
.info-panel {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.current-item-card {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    padding: 20px;
    border-radius: 15px;
    border: 3px solid #ff9800;
    box-shadow: 0 5px 15px rgba(255, 152, 0, 0.2);
}

.current-item-card h4 {
    color: #e65100;
    font-size: 16px;
    margin-bottom: 15px;
    text-align: center;
}

.item-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
}

.target-emoji {
    font-size: 60px;
    animation: float 2s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.target-name {
    font-size: 18px;
    font-weight: 700;
    color: #333;
}

.item-type {
    text-align: center;
    background: white;
    padding: 8px 15px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    color: #4caf50;
}

/* ===================================
   SCIENCE FACT CARD
   =================================== */
.science-fact-card {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    padding: 20px;
    border-radius: 15px;
    border: 3px solid #2196f3;
    box-shadow: 0 5px 15px rgba(33, 150, 243, 0.2);
}

.fact-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
}

.fact-icon {
    font-size: 24px;
}

.science-fact-card h4 {
    color: #1565c0;
    font-size: 16px;
    margin: 0;
}

#factText {
    color: #333;
    font-size: 14px;
    line-height: 1.6;
}

/* ===================================
   QUESTION PROGRESS
   =================================== */
.question-progress {
    background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
    padding: 20px;
    border-radius: 15px;
    border: 3px solid #9c27b0;
    box-shadow: 0 5px 15px rgba(156, 39, 176, 0.2);
}

.question-progress h4 {
    color: #6a1b9a;
    font-size: 16px;
    margin-bottom: 15px;
}

.progress-bar-container {
    background: white;
    border-radius: 20px;
    height: 30px;
    overflow: hidden;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
    margin-bottom: 10px;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #4caf50 0%, #8bc34a 100%);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: width 0.5s ease;
    box-shadow: 0 2px 5px rgba(76, 175, 80, 0.3);
}

#progressText {
    color: white;
    font-weight: 700;
    font-size: 14px;
}

#nextMilestone {
    color: #6a1b9a;
    font-size: 13px;
    text-align: center;
    font-weight: 600;
}

/* ===================================
   CONTROLS REMINDER
   =================================== */
.controls-reminder {
    background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
    padding: 20px;
    border-radius: 15px;
    border: 3px solid #e91e63;
    text-align: center;
}

.controls-reminder h4 {
    color: #c2185b;
    font-size: 16px;
    margin-bottom: 10px;
}

.key-display {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 15px 0;
}

.key-display kbd {
    background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.controls-reminder p {
    color: #880e4f;
    font-size: 13px;
    font-weight: 600;
}

/* ===================================
   END SCREEN
   =================================== */
#endScreen {
    max-width: 900px;
    margin: 0 auto;
    text-align: center;
}

.celebration {
    font-size: 100px;
    animation: celebration 1s ease-in-out infinite;
}

@keyframes celebration {
    0%, 100% { transform: rotate(-10deg) scale(1); }
    50% { transform: rotate(10deg) scale(1.1); }
}

#endScreen h1 {
    font-size: 42px;
    background: linear-gradient(135deg, #4caf50 0%, #2196f3 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    font-weight: 800;
}

#endScreen h2 {
    color: #2c5364;
    font-size: 28px;
    margin-bottom: 30px;
}

.final-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 30px 0;
}

.final-stat-card {
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    padding: 25px;
    border-radius: 20px;
    border: 3px solid #4caf50;
    box-shadow: 0 5px 15px rgba(76, 175, 80, 0.2);
}

.final-stat-icon {
    font-size: 50px;
    margin-bottom: 10px;
}

.final-stat-content h3 {
    color: #2e7d32;
    font-size: 16px;
    margin-bottom: 10px;
}

.final-number {
    font-size: 36px;
    font-weight: 900;
    color: #1b5e20;
    margin: 0;
}

.final-stars {
    font-size: 32px;
}

/* ===================================
   PERFORMANCE BADGE
   =================================== */
.performance-badge {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    padding: 30px;
    border-radius: 20px;
    border: 3px solid #ff9800;
    margin: 30px 0;
    box-shadow: 0 10px 30px rgba(255, 152, 0, 0.3);
}

.badge-icon {
    font-size: 80px;
    margin-bottom: 15px;
}

.performance-badge h3 {
    color: #e65100;
    font-size: 28px;
    margin-bottom: 10px;
}

.performance-badge p {
    color: #666;
    font-size: 18px;
}

/* ===================================
   LEARNING SUMMARY
   =================================== */
.learning-summary {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    padding: 25px;
    border-radius: 20px;
    border: 3px solid #2196f3;
    margin: 30px 0;
}

.learning-summary h3 {
    color: #1565c0;
    font-size: 22px;
    margin-bottom: 20px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}

.summary-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    color: #333;
    font-size: 14px;
    font-weight: 600;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
}

.end-buttons {
    display: flex;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 30px;
}

/* ===================================
   QUESTION MODAL
   =================================== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal.active {
    display: flex;
}

.modal-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
}

.modal-content {
    position: relative;
    background: white;
    border-radius: 25px;
    padding: 40px;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    animation: modalSlideIn 0.4s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-header {
    text-align: center;
    margin-bottom: 30px;
    border-bottom: 3px solid #4caf50;
    padding-bottom: 20px;
}

.modal-header h2 {
    color: #2e7d32;
    font-size: 28px;
    margin-bottom: 10px;
}

.question-counter {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    color: white;
    padding: 8px 20px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 700;
    display: inline-block;
}

.question-container {
    margin: 30px 0;
}

.question-box {
    background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
    padding: 25px;
    border-radius: 15px;
    border: 3px solid #ff9800;
    margin-bottom: 20px;
    position: relative;
}

.question-icon {
    font-size: 40px;
    margin-bottom: 15px;
}

.question-box p {
    color: #333;
    font-size: 18px;
    font-weight: 700;
    line-height: 1.6;
}

.answer-box {
    background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
    padding: 25px;
    border-radius: 15px;
    border: 3px solid #4caf50;
}

.answer-icon {
    font-size: 40px;
    margin-bottom: 15px;
}

.answer-box h4 {
    color: #2e7d32;
    font-size: 18px;
    margin-bottom: 15px;
}

.answer-box p {
    color: #333;
    font-size: 16px;
    line-height: 1.8;
    white-space: pre-line;
}

.modal-footer {
    text-align: center;
    margin-top: 30px;
    border-top: 3px solid #e0e0e0;
    padding-top: 20px;
}

.modal-timer {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    color: #1565c0;
    padding: 12px 25px;
    border-radius: 20px;
    font-size: 16px;
    font-weight: 700;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
}

.timer-icon {
    font-size: 20px;
}

/* ===================================
   PAUSE OVERLAY
   =================================== */
.pause-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(10px);
    z-index: 999;
    justify-content: center;
    align-items: center;
}

.pause-overlay.active {
    display: flex;
}

.pause-content {
    background: white;
    padding: 50px;
    border-radius: 25px;
    text-align: center;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

.pause-content h2 {
    color: #2c5364;
    font-size: 36px;
    margin-bottom: 20px;
}

.pause-content p {
    color: #666;
    font-size: 18px;
    margin-bottom: 30px;
}

/* ===================================
   RESPONSIVE DESIGN
   =================================== */
@media (max-width: 768px) {
    #startScreen h1 {
        font-size: 32px;
    }
    
    .logo-animation {
        font-size: 60px;
    }
    
    .learning-cards {
        grid-template-columns: 1fr;
    }
    
    .instruction-grid {
        grid-template-columns: 1fr;
    }
    
    .game-header {
        flex-direction: column;
    }
    
    .game-stats {
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .final-stats {
        grid-template-columns: 1fr;
    }
    
    .modal-content {
        padding: 25px;
    }
    
    .pause-content {
        padding: 30px;
    }
    
    .celebration {
        font-size: 60px;
    }
}

/* ===================================
   ACCESSIBILITY
   =================================== */
button:focus, .diff-btn:focus {
    outline: 3px solid #2196f3;
    outline-offset: 2px;
}

.screen:focus-within {
    box-shadow: 
        0 20px 60px rgba(0, 0, 0, 0.4),
        0 0 100px rgba(76, 175, 80, 0.2);
}

/* ===================================
   PRINT STYLES
   =================================== */
@media print {
    .background-particles,
    .music-toggle,
    button {
        display: none;
    }
    
    .screen {
        box-shadow: none;
        border: 2px solid #333;
    }
}

/* ===================================
   SCROLLBAR STYLING
   =================================== */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
}

/* ===================================
   SELECTION STYLING
   =================================== */
::selection {
    background: #4caf50;
    color: white;
}

::-moz-selection {
    background: #4caf50;
    color: white;
}

    </style>
</head>
<body>
    <div class="background-particles"></div>

    <div class="container">
        <!-- Start Screen -->
        <div id="startScreen" class="screen active">
            <div class="logo-animation">üî¨</div>
            <h1>Science Room Rules Game</h1>
            <h2>Science Year 1 KSSR - Topic 2</h2>
            <p class="subtitle">Learn to Be Safe and Responsible in the Science Room!</p>

            <!-- Topic Showcase -->
            <div class="topic-showcase">
                <div class="showcase-header">
                    <h3>üéØ What You'll Learn:</h3>
                </div>
                <div class="learning-cards">
                    <div class="learning-card">
                        <div class="card-icon">üìã</div>
                        <h4>5 Basic Rules</h4>
                        <p>Line up, ask permission, no running, no eating, clean up!</p>
                    </div>
                    <div class="learning-card">
                        <div class="card-icon">‚úÖ</div>
                        <h4>Correct Behaviors</h4>
                        <p>Learn what to do and what NOT to do in the Science Room</p>
                    </div>
                    <div class="learning-card">
                        <div class="card-icon">üõ°Ô∏è</div>
                        <h4>Why Rules Matter</h4>
                        <p>Understand how rules keep us safe and help us learn</p>
                    </div>
                </div>
            </div>

            <!-- Game Instructions -->
            <div class="game-instructions">
                <h3>üéÆ How to Play:</h3>
                <div class="instruction-grid">
                    <div class="instruction-item">
                        <div class="step-number">1</div>
                        <p>Use <kbd>‚Üë</kbd> <kbd>‚Üì</kbd> <kbd>‚Üê</kbd> <kbd>‚Üí</kbd> arrow keys to move</p>
                    </div>
                    <div class="instruction-item">
                        <div class="step-number">2</div>
                        <p>Collect <strong>correct</strong> Science Room behaviors</p>
                    </div>
                    <div class="instruction-item">
                        <div class="step-number">3</div>
                        <p>Learn rules and answer questions about safety</p>
                    </div>
                    <div class="instruction-item">
                        <div class="step-number">4</div>
                        <p>Complete 3 stages to become a Safety Expert!</p>
                    </div>
                </div>
            </div>

            <!-- Difficulty Selector -->
            <div class="difficulty-selector">
                <label>Choose Difficulty:</label>
                <button class="diff-btn" onclick="setDifficulty('easy')">üå± Easy</button>
                <button class="diff-btn active" onclick="setDifficulty('medium')">üî¨ Medium</button>
                <button class="diff-btn" onclick="setDifficulty('hard')">üî• Hard</button>
            </div>

            <button class="start-btn pulse" onclick="startGame()">üöÄ Start Learning!</button>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <!-- Game Header -->
            <div class="game-header">
                <div class="stage-badge">
                    <span class="stage-icon">üìã</span>
                    <span class="stage-text">Stage 1: Basic Science Room Rules</span>
                </div>

                <div class="game-stats">
                    <div class="stat-item score-stat">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-content">
                            <div class="stat-label">Score</div>
                            <div class="stat-value" id="score">0</div>
                        </div>
                    </div>

                    <div class="stat-item time-stat">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-content">
                            <div class="stat-label">Time</div>
                            <div class="stat-value" id="timer">0s</div>
                        </div>
                    </div>

                    <div class="stat-item stars-stat">
                        <div class="stat-icon">‚≠ê</div>
                        <div class="stat-content">
                            <div class="stat-label">Stars</div>
                            <div class="stat-value" id="stars">0</div>
                        </div>
                    </div>

                    <button class="music-toggle" onclick="toggleMusic()">
                        <span id="musicIcon">üîá</span>
                    </button>
                </div>
            </div>

            <!-- Game Content -->
            <div class="game-content">
                <div class="canvas-container">
                    <canvas id="canvas" width="600" height="600"></canvas>
                    <div id="comboDisplay" class="combo-display"></div>
                </div>

                <!-- Info Panel -->
                <div class="info-panel">
                    <!-- Current Item -->
                    <div class="current-item-card">
                        <h4>üéØ Collect This Item:</h4>
                        <div class="item-display">
                            <div class="target-emoji" id="targetEmoji">üö∂‚Äç‚ôÇÔ∏è</div>
                            <div class="target-name" id="targetName">Line Up</div>
                        </div>
                        <div class="item-type" id="itemType">CORRECT</div>
                    </div>

                    <!-- Science Fact -->
                    <div class="science-fact-card">
                        <div class="fact-header">
                            <span class="fact-icon">üí°</span>
                            <h4>Science Room Rule</h4>
                        </div>
                        <p id="factText">Collect items to learn about Science Room safety rules!</p>
                    </div>

                    <!-- Progress -->
                    <div class="question-progress">
                        <h4>üìö Learning Progress</h4>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progressBar" style="width: 0%">
                                <span id="progressText">0%</span>
                            </div>
                        </div>
                        <p id="nextMilestone">Next question at 80 points!</p>
                    </div>

                    <!-- Controls Reminder -->
                    <div class="controls-reminder">
                        <h4>üéÆ Controls</h4>
                        <div class="key-display">
                            <kbd>‚Üë</kbd>
                            <kbd>‚Üì</kbd>
                            <kbd>‚Üê</kbd>
                            <kbd>‚Üí</kbd>
                        </div>
                        <p>Press <kbd>P</kbd> to pause</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- End Screen -->
        <div id="endScreen" class="screen">
            <div class="celebration">üéâ</div>
            <h1>Congratulations!</h1>
            <h2>You've mastered the Science Room Rules!</h2>

            <!-- Final Stats -->
            <div class="final-stats">
                <div class="final-stat-card">
                    <div class="final-stat-icon">üéØ</div>
                    <div class="final-stat-content">
                        <h3>Total Score</h3>
                        <p class="final-number" id="finalScore">0</p>
                    </div>
                </div>

                <div class="final-stat-card">
                    <div class="final-stat-icon">‚è±Ô∏è</div>
                    <div class="final-stat-content">
                        <h3>Time Taken</h3>
                        <p class="final-number" id="finalTime">0s</p>
                    </div>
                </div>

                <div class="final-stat-card">
                    <div class="final-stat-icon">‚≠ê</div>
                    <div class="final-stat-content">
                        <h3>Stars Earned</h3>
                        <p class="final-stars" id="starDisplay">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</p>
                    </div>
                </div>
            </div>

            <!-- Performance Badge -->
            <div class="performance-badge">
                <div class="badge-icon">üèÜ</div>
                <h3 id="performanceTitle">Science Room Safety Expert!</h3>
                <p id="performanceMessage">Perfect! You know all the Science Room rules!</p>
            </div>

            <!-- Learning Summary -->
            <div class="learning-summary">
                <h3>üìö What You've Learned:</h3>
                <div class="summary-grid">
                    <div class="summary-item">‚úÖ Line up before entering the Science Room</div>
                    <div class="summary-item">‚úÖ Ask teacher's permission before entering</div>
                    <div class="summary-item">‚úÖ No running or playing in the Science Room</div>
                    <div class="summary-item">‚úÖ No eating or drinking in the Science Room</div>
                    <div class="summary-item">‚úÖ Clean and tidy up before leaving</div>
                    <div class="summary-item">‚úÖ Follow teacher's instructions for safety</div>
                </div>
            </div>

            <!-- End Buttons -->
            <div class="end-buttons">
                <button class="play-again-btn" onclick="restartGame()">üîÑ Play Again</button>
                <button class="share-btn" onclick="shareScore()">üì± Share Score</button>
            </div>
        </div>
    </div>

    <!-- Question Modal -->
    <div id="questionModal" class="modal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2>üß™ Science Question Time!</h2>
                <div class="question-counter">
                    Question <span id="questionNumber">1</span> of <span id="totalQuestions">4</span>
                </div>
            </div>

            <div class="question-container">
                <div class="question-box">
                    <div class="question-icon">‚ùì</div>
                    <p id="modalQuestion">What are the 5 main Science Room Rules?</p>
                </div>

                <div class="answer-box">
                    <div class="answer-icon">üí°</div>
                    <h4>Answer:</h4>
                    <p id="modalAnswer">1. LINE UP before entering...</p>
                </div>
            </div>

            <div class="modal-footer">
                <div class="modal-timer">
                    <span class="timer-icon">‚è∞</span>
                    Read carefully! <span id="modalTimer">15</span>s
                </div>
                <button class="next-question-btn" onclick="nextQuestion()">‚úÖ Continue Learning</button>
            </div>
        </div>
    </div>

    <!-- Pause Overlay -->
    <div id="pauseOverlay" class="pause-overlay">
        <div class="pause-content">
            <h2>‚è∏Ô∏è Game Paused</h2>
            <p>Press P to continue playing!</p>
            <button class="start-btn" onclick="togglePause()">‚ñ∂Ô∏è Resume</button>
        </div>
    </div>

    <script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const gridSize = 30;
const tileCount = canvas.width / gridSize;

// Game State
let snake = [{x: 10, y: 10}];
let dx = 1;
let dy = 0;
let foodX = 15;
let foodY = 15;
let score = 0;
let stars = 0;
let gameLoop;
let timerInterval;
let timeElapsed = 0;
let gameSpeed = 120;
let currentStage = 1;
let questionIndex = 0;
let questionsAnswered = 0;
let gameLoopPaused = false;
let isPaused = false;
let combo = 0;
let highestCombo = 0;
let difficulty = 'medium';

// Audio
let audioContext = null;
let isMusicPlaying = false;
let currentOscillators = [];

// Topic 2: Science Room Rules (Malaysian Science Year 1 KSSR)
// Based on official textbook content

// Stage 1: Basic Science Room Rules
const stage1Items = [
    {
        emoji: 'üö∂‚Äç‚ôÇÔ∏è',
        name: 'Line Up',
        type: 'CORRECT',
        fact: 'RULE 1: Line up before entering the Science Room. This keeps us organized and safe!',
        characteristic: 'Entering the Science Room'
    },
    {
        emoji: '‚úã',
        name: 'Ask Permission',
        type: 'CORRECT',
        fact: 'RULE 2: Ask for the teacher\'s permission before entering the Science Room. Never go in alone!',
        characteristic: 'Permission'
    },
    {
        emoji: 'üßπ',
        name: 'Clean Up',
        type: 'CORRECT',
        fact: 'RULE 3: Clean and tidy up the Science Room before leaving. Keep it neat for the next class!',
        characteristic: 'Leaving the Science Room'
    },
    {
        emoji: 'üö´üèÉ',
        name: 'No Running',
        type: 'CORRECT',
        fact: 'RULE 4: No playing and running in the Science Room. You might get injured or break equipment!',
        characteristic: 'Safe Behavior'
    },
    {
        emoji: 'üö´üçî',
        name: 'No Eating',
        type: 'CORRECT',
        fact: 'RULE 5: No eating and drinking in the Science Room. You might consume dangerous chemicals!',
        characteristic: 'Safe Behavior'
    },
    {
        emoji: 'üë©‚Äçüè´',
        name: 'Follow Teacher',
        type: 'CORRECT',
        fact: 'Always follow the teacher\'s instructions when conducting activities. Safety first!',
        characteristic: 'Instructions'
    },
    {
        emoji: 'üî¨',
        name: 'Use Equipment Properly',
        type: 'CORRECT',
        fact: 'Use all science equipment carefully and correctly. Handle with care!',
        characteristic: 'Equipment Safety'
    },
    {
        emoji: '‚ö†Ô∏è',
        name: 'Report Accidents',
        type: 'CORRECT',
        fact: 'Report any accidents in the Science Room to the teacher immediately!',
        characteristic: 'Safety Protocol'
    }
];

// Stage 2: Correct vs Wrong Behaviors
const stage2Items = [
    {
        emoji: 'üö∂‚Äç‚ôÇÔ∏è',
        name: 'Walking Carefully',
        type: 'CORRECT',
        fact: 'CORRECT! Walking carefully in the Science Room is safe and follows the rules.',
        isCorrect: true
    },
    {
        emoji: 'üèÉ',
        name: 'Running',
        type: 'WRONG',
        fact: 'WRONG! Running in the Science Room is dangerous! You might fall or break equipment.',
        isCorrect: false
    },
    {
        emoji: '‚úã',
        name: 'Raising Hand',
        type: 'CORRECT',
        fact: 'CORRECT! Raising your hand to ask permission shows good Science Room behavior!',
        isCorrect: true
    },
    {
        emoji: 'üçï',
        name: 'Eating Food',
        type: 'WRONG',
        fact: 'WRONG! Eating in the Science Room is forbidden! You might eat chemicals by mistake!',
        isCorrect: false
    },
    {
        emoji: 'üßπ',
        name: 'Cleaning Tables',
        type: 'CORRECT',
        fact: 'CORRECT! Cleaning tables after experiments keeps the Science Room tidy and safe!',
        isCorrect: true
    },
    {
        emoji: 'üéÆ',
        name: 'Playing Games',
        type: 'WRONG',
        fact: 'WRONG! Playing and fooling around in the Science Room can cause accidents!',
        isCorrect: false
    },
    {
        emoji: 'üëÇ',
        name: 'Listening to Teacher',
        type: 'CORRECT',
        fact: 'CORRECT! Listening carefully to the teacher\'s instructions keeps everyone safe!',
        isCorrect: true
    },
    {
        emoji: 'üóëÔ∏è',
        name: 'Throwing Rubbish Properly',
        type: 'CORRECT',
        fact: 'CORRECT! Put rubbish in the bin, NOT in the sink! Keep the Science Room clean!',
        isCorrect: true
    }
];

// Stage 3: Why Rules Are Important
const stage3Items = [
    {
        emoji: 'üõ°Ô∏è',
        name: 'Safety',
        type: 'IMPORTANCE',
        fact: 'Science Room rules keep us SAFE from injuries and accidents!',
        reason: 'Safety'
    },
    {
        emoji: '‚ú®',
        name: 'Cleanliness',
        type: 'IMPORTANCE',
        fact: 'Following rules keeps the Science Room CLEAN and tidy for everyone!',
        reason: 'Cleanliness'
    },
    {
        emoji: 'üìö',
        name: 'Good Learning',
        type: 'IMPORTANCE',
        fact: 'Rules create a good environment for learning and conducting experiments!',
        reason: 'Learning'
    },
    {
        emoji: 'üîß',
        name: 'Equipment Care',
        type: 'IMPORTANCE',
        fact: 'Rules help us take care of science equipment so they last longer!',
        reason: 'Equipment Protection'
    },
    {
        emoji: 'üíß',
        name: 'Prevent Spills',
        type: 'IMPORTANCE',
        fact: 'No eating and drinking prevents spills and contamination in the Science Room!',
        reason: 'Prevent Accidents'
    },
    {
        emoji: 'ü§ù',
        name: 'Respect',
        type: 'IMPORTANCE',
        fact: 'Following rules shows respect for the teacher, classmates, and the Science Room!',
        reason: 'Respect'
    },
    {
        emoji: '‚öóÔ∏è',
        name: 'Chemical Safety',
        type: 'IMPORTANCE',
        fact: 'Rules prevent us from accidentally touching or consuming dangerous chemicals!',
        reason: 'Chemical Safety'
    },
    {
        emoji: 'üéØ',
        name: 'Focus',
        type: 'IMPORTANCE',
        fact: 'No playing or running helps everyone focus on learning science!',
        reason: 'Focus on Learning'
    }
];

// Questions for Stage 1: Basic Rules
const stage1Questions = [
    {
        question: 'What are the 5 main Science Room Rules?',
        answer: '1. LINE UP before entering the Science Room\n2. ASK PERMISSION from teacher before entering\n3. NO PLAYING and RUNNING in the Science Room\n4. NO EATING and DRINKING in the Science Room\n5. CLEAN and TIDY UP before leaving the Science Room'
    },
    {
        question: 'Why must we line up before entering the Science Room?',
        answer: 'We must line up because:\n‚Ä¢ It keeps us organized and orderly\n‚Ä¢ It prevents crowding at the door\n‚Ä¢ It shows respect and discipline\n‚Ä¢ The teacher can see everyone clearly\n‚Ä¢ It helps us enter safely one by one'
    },
    {
        question: 'Why can\'t we eat or drink in the Science Room?',
        answer: 'We cannot eat or drink because:\n‚Ä¢ We might accidentally eat or drink chemicals\n‚Ä¢ Food can contaminate experiments\n‚Ä¢ Spills make the Science Room dirty\n‚Ä¢ It\'s very DANGEROUS for our health\n‚Ä¢ Chemicals can look like food or drinks!'
    },
    {
        question: 'What should we do before leaving the Science Room?',
        answer: 'Before leaving, we must:\n‚Ä¢ CLEAN the tables and work area\n‚Ä¢ PUT AWAY all equipment properly\n‚Ä¢ THROW rubbish in the bin (not the sink!)\n‚Ä¢ TIDY UP chairs and arrange them neatly\n‚Ä¢ Make sure the Science Room is clean for the next class'
    }
];

// Questions for Stage 2: Correct vs Wrong Behaviors
const stage2Questions = [
    {
        question: 'What happens if you run in the Science Room?',
        answer: 'If you run in the Science Room:\n‚Ä¢ You might FALL and get injured\n‚Ä¢ You might BUMP into tables or equipment\n‚Ä¢ You might BREAK expensive science tools\n‚Ä¢ You might SPILL dangerous chemicals\n‚Ä¢ You might HURT yourself or your friends\n\nAlways WALK carefully in the Science Room!'
    },
    {
        question: 'Why must we ask the teacher\'s permission before entering?',
        answer: 'We must ask permission because:\n‚Ä¢ The teacher needs to know who is in the room\n‚Ä¢ The Science Room might not be ready yet\n‚Ä¢ There might be dangerous experiments happening\n‚Ä¢ The teacher can supervise us properly\n‚Ä¢ It shows good manners and responsibility'
    },
    {
        question: 'What is the correct way to behave in the Science Room?',
        answer: 'CORRECT behaviors:\n‚Ä¢ WALK carefully (never run)\n‚Ä¢ LISTEN to the teacher\'s instructions\n‚Ä¢ HANDLE equipment with care\n‚Ä¢ KEEP your area clean\n‚Ä¢ RAISE your hand to ask questions\n‚Ä¢ REPORT any accidents immediately\n‚Ä¢ FOLLOW all safety rules'
    },
    {
        question: 'What would happen if we throw rubbish into the sink?',
        answer: 'If we throw rubbish in the sink:\n‚Ä¢ The sink will get BLOCKED\n‚Ä¢ Water cannot flow properly\n‚Ä¢ It creates a DIRTY and unhygienic environment\n‚Ä¢ It\'s hard to clean and fix\n‚Ä¢ It wastes time and money\n\nAlways throw rubbish in the BIN, not the sink!'
    }
];

// Questions for Stage 3: Importance of Rules
const stage3Questions = [
    {
        question: 'Why are Science Room Rules important?',
        answer: 'Science Room Rules are important for:\n1. SAFETY - Protect us from injuries and accidents\n2. CLEANLINESS - Keep the room tidy and organized\n3. LEARNING - Create a good environment to learn\n4. RESPECT - Show respect for teacher and classmates\n5. EQUIPMENT CARE - Protect expensive science tools'
    },
    {
        question: 'How do Science Room Rules keep us safe?',
        answer: 'Rules keep us safe by:\n‚Ä¢ Preventing us from running and getting injured\n‚Ä¢ Stopping us from eating dangerous chemicals\n‚Ä¢ Making sure we use equipment correctly\n‚Ä¢ Ensuring the teacher supervises all activities\n‚Ä¢ Teaching us to report accidents immediately\n‚Ä¢ Keeping the room clean and hazard-free'
    },
    {
        question: 'What should you do if there is an accident in the Science Room?',
        answer: 'If there is an accident:\n1. STAY CALM - Don\'t panic\n2. TELL THE TEACHER immediately\n3. DON\'T TOUCH anything dangerous\n4. MOVE AWAY from the accident area\n5. FOLLOW the teacher\'s instructions\n6. HELP your friends if it\'s safe to do so\n\nAlways report to the teacher FIRST!'
    },
    {
        question: 'List 3 things you must NEVER do in the Science Room.',
        answer: 'NEVER do these in the Science Room:\n1. NEVER run or play - You might fall or break things\n2. NEVER eat or drink - You might consume chemicals\n3. NEVER touch equipment without permission - It might be dangerous\n4. NEVER ignore the teacher - Instructions keep you safe\n5. NEVER throw rubbish in the sink - It will block the drain'
    },
    {
        question: 'How can you be a responsible student in the Science Room?',
        answer: 'Be responsible by:\n‚Ä¢ FOLLOWING all Science Room rules\n‚Ä¢ LISTENING to the teacher carefully\n‚Ä¢ CLEANING up after experiments\n‚Ä¢ HELPING classmates follow the rules\n‚Ä¢ USING equipment properly and carefully\n‚Ä¢ REPORTING any problems immediately\n‚Ä¢ SHOWING respect for the Science Room\n‚Ä¢ BEING a good role model for others'
    }
];

let currentItems = stage1Items;
let currentQuestions = stage1Questions;
let currentItem = currentItems[0];

// Initialize game
function setDifficulty(level) {
    difficulty = level;
    document.querySelectorAll('.diff-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    switch(level) {
        case 'easy': gameSpeed = 150; break;
        case 'medium': gameSpeed = 120; break;
        case 'hard': gameSpeed = 90; break;
    }
}

function startGame() {
    // Reset game state
    snake = [{x: 10, y: 10}];
    dx = 1;
    dy = 0;
    score = 0;
    stars = 0;
    timeElapsed = 0;
    currentStage = 1;
    questionIndex = 0;
    questionsAnswered = 0;
    combo = 0;
    highestCombo = 0;
    gameLoopPaused = false;
    isPaused = false;
    currentItems = stage1Items;
    currentQuestions = stage1Questions;

    // UI Updates
    document.getElementById('startScreen').classList.remove('active');
    document.getElementById('gameScreen').classList.add('active');
    updateScore();
    updateStars();
    updateStageInfo();
    generateFood();

    // Start game loops
    gameLoop = setInterval(update, gameSpeed);
    timerInterval = setInterval(updateTimer, 1000);
}

function update() {
    if (gameLoopPaused || isPaused) return;
    moveSnake();
    if (checkCollision()) {
        endGame();
        return;
    }

    if (snake[0].x === foodX && snake[0].y === foodY) {
        score += 10;
        combo++;
        if (combo > highestCombo) highestCombo = combo;
        updateScore();
        updateStars();
        updateProgress();
        showCombo();
        document.getElementById('factText').textContent = currentItem.fact;
        playCollectSound();

        // Check for question trigger (every 80 points)
        if (score % 80 === 0 && score > 0) {
            if (questionIndex < currentQuestions.length) {
                showQuestionModal();
            }
        }
        generateFood();
    } else {
        snake.pop();
    }

    draw();
}

function moveSnake() {
    let newX = snake[0].x + dx;
    let newY = snake[0].y + dy;

    // Wrap around borders
    if (newX < 0) newX = tileCount - 1;
    if (newX >= tileCount) newX = 0;
    if (newY < 0) newY = tileCount - 1;
    if (newY >= tileCount) newY = 0;

    snake.unshift({x: newX, y: newY});
}

function checkCollision() {
    const head = snake[0];
    for (let i = 1; i < snake.length; i++) {
        if (head.x === snake[i].x && head.y === snake[i].y) {
            return true;
        }
    }
    return false;
}

function generateFood() {
    foodX = Math.floor(Math.random() * tileCount);
    foodY = Math.floor(Math.random() * tileCount);
    currentItem = currentItems[Math.floor(Math.random() * currentItems.length)];

    // Update target display
    document.getElementById('targetEmoji').textContent = currentItem.emoji;
    document.getElementById('targetName').textContent = currentItem.name;
    document.getElementById('itemType').textContent = currentItem.type;

    // Check if food spawns on snake
    for (let segment of snake) {
        if (segment.x === foodX && segment.y === foodY) {
            generateFood();
            return;
        }
    }
}

function draw() {
    // Background
    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
    if (currentStage === 1) {
        gradient.addColorStop(0, '#e8f5e9');
        gradient.addColorStop(1, '#c8e6c9');
    } else if (currentStage === 2) {
        gradient.addColorStop(0, '#fff3e0');
        gradient.addColorStop(1, '#ffe0b2');
    } else {
        gradient.addColorStop(0, '#e3f2fd');
        gradient.addColorStop(1, '#bbdefb');
    }

    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Grid
    ctx.strokeStyle = 'rgba(0,0,0,0.05)';
    ctx.lineWidth = 1;
    for (let i = 0; i < tileCount; i++) {
        ctx.beginPath();
        ctx.moveTo(i * gridSize, 0);
        ctx.lineTo(i * gridSize, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, i * gridSize);
        ctx.lineTo(canvas.width, i * gridSize);
        ctx.stroke();
    }

    // Snake
    for (let i = 0; i < snake.length; i++) {
        const segment = snake[i];
        const x = segment.x * gridSize;
        const y = segment.y * gridSize;

        if (i === 0) {
            // Head
            const headGradient = ctx.createRadialGradient(x + gridSize/2, y + gridSize/2, 0, x + gridSize/2, y + gridSize/2, gridSize/2);
            headGradient.addColorStop(0, '#4caf50');
            headGradient.addColorStop(1, '#2e7d32');
            ctx.fillStyle = headGradient;
            ctx.fillRect(x + 3, y + 3, gridSize - 6, gridSize - 6);

            // Eyes
            ctx.fillStyle = 'white';
            ctx.fillRect(x + 8, y + 8, 6, 6);
            ctx.fillRect(x + gridSize - 14, y + 8, 6, 6);
            ctx.fillStyle = 'black';
            ctx.fillRect(x + 10, y + 10, 3, 3);
            ctx.fillRect(x + gridSize - 12, y + 10, 3, 3);
        } else {
            // Body
            ctx.fillStyle = `rgba(76, 175, 80, ${1 - (i / snake.length) * 0.5})`;
            ctx.fillRect(x + 4, y + 4, gridSize - 8, gridSize - 8);
        }
    }

    // Food
    ctx.font = 'bold 24px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(currentItem.emoji, foodX * gridSize + gridSize/2, foodY * gridSize + gridSize/2);
}

function updateScore() {
    document.getElementById('score').textContent = score;
}

function updateStars() {
    if (score < 80) stars = 0;
    else if (score < 160) stars = 1;
    else if (score < 240) stars = 2;
    else if (score < 320) stars = 3;
    else if (score < 400) stars = 4;
    else stars = 5;
    document.getElementById('stars').textContent = '‚≠ê'.repeat(stars) || '0';
}

function updateProgress() {
    const maxScore = 480;
    const progress = Math.min((score / maxScore) * 100, 100);
    document.getElementById('progressBar').style.width = progress + '%';
    document.getElementById('progressText').textContent = Math.floor(progress) + '%';

    const nextMilestone = Math.ceil(score / 80) * 80;
    if (nextMilestone <= maxScore) {
        document.getElementById('nextMilestone').textContent = `Next question at ${nextMilestone} points!`;
    } else {
        document.getElementById('nextMilestone').textContent = 'All questions unlocked!';
    }
}

function updateTimer() {
    timeElapsed++;
    document.getElementById('timer').textContent = timeElapsed + 's';
}

function updateStageInfo() {
    const stageData = [
        { icon: 'üìã', text: 'Stage 1: Basic Science Room Rules' },
        { icon: '‚úÖ', text: 'Stage 2: Correct vs Wrong Behaviors' },
        { icon: 'üí°', text: 'Stage 3: Why Rules Are Important' }
    ];
    const stage = stageData[currentStage - 1];
    document.querySelector('.stage-icon').textContent = stage.icon;
    document.querySelector('.stage-text').textContent = stage.text;
}

function showCombo() {
    if (combo > 1) {
        const comboDisplay = document.getElementById('comboDisplay');
        comboDisplay.textContent = `${combo}x COMBO! üî•`;
        comboDisplay.style.display = 'block';
        setTimeout(() => {
            comboDisplay.style.display = 'none';
        }, 1000);
    }
}

function showQuestionModal() {
    if (questionIndex >= currentQuestions.length) return;

    gameLoopPaused = true;
    const q = currentQuestions[questionIndex];

    document.getElementById('modalQuestion').textContent = q.question;
    document.getElementById('modalAnswer').textContent = q.answer;
    document.getElementById('questionNumber').textContent = questionIndex + 1;
    document.getElementById('totalQuestions').textContent = currentQuestions.length;
    document.getElementById('questionModal').classList.add('active');

    let timeLeft = 15;
    document.getElementById('modalTimer').textContent = timeLeft;
    const modalTimer = setInterval(() => {
        timeLeft--;
        document.getElementById('modalTimer').textContent = timeLeft;
        if (timeLeft <= 0) {
            clearInterval(modalTimer);
        }
    }, 1000);
}

function nextQuestion() {
    document.getElementById('questionModal').classList.remove('active');
    questionIndex++;
    questionsAnswered++;

    // Check stage transition
    if (currentStage === 1 && questionsAnswered >= stage1Questions.length) {
        transitionToStage2();
    } else if (currentStage === 2 && questionsAnswered >= stage2Questions.length) {
        transitionToStage3();
    } else if (currentStage === 3 && questionsAnswered >= stage3Questions.length) {
        endGame();
        return;
    }

    gameLoopPaused = false;
}

function transitionToStage2() {
    currentStage = 2;
    currentItems = stage2Items;
    currentQuestions = stage2Questions;
    questionIndex = 0;
    updateStageInfo();
    generateFood();
}

function transitionToStage3() {
    currentStage = 3;
    currentItems = stage3Items;
    currentQuestions = stage3Questions;
    questionIndex = 0;
    updateStageInfo();
    generateFood();
}

function endGame() {
    clearInterval(gameLoop);
    clearInterval(timerInterval);
    stopMusic();

    document.getElementById('gameScreen').classList.remove('active');
    document.getElementById('endScreen').classList.add('active');

    document.getElementById('finalScore').textContent = score;
    document.getElementById('finalTime').textContent = timeElapsed + 's';
    document.getElementById('starDisplay').textContent = '‚≠ê'.repeat(stars) || 'No stars yet';

    // Performance evaluation
    let badgeIcon, title, message;
    if (score >= 400) {
        badgeIcon = 'üèÜ';
        title = 'Science Room Safety Expert!';
        message = 'Perfect! You know all the Science Room rules!';
    } else if (score >= 300) {
        badgeIcon = 'ü•á';
        title = 'Safety Champion!';
        message = 'Great job! You understand the rules very well!';
    } else if (score >= 200) {
        badgeIcon = 'ü•à';
        title = 'Safety Learner!';
        message = 'Good work! Keep practicing the rules!';
    } else {
        badgeIcon = 'ü•â';
        title = 'Safety Explorer!';
        message = 'Nice try! Play again to learn more rules!';
    }

    document.querySelector('.badge-icon').textContent = badgeIcon;
    document.getElementById('performanceTitle').textContent = title;
    document.getElementById('performanceMessage').textContent = message;
}

function restartGame() {
    document.getElementById('endScreen').classList.remove('active');
    document.getElementById('startScreen').classList.add('active');
}

function togglePause() {
    isPaused = !isPaused;
    document.getElementById('pauseOverlay').classList.toggle('active', isPaused);
}

function shareScore() {
    const text = `I scored ${score} points learning Science Room Rules! Can you beat my score? üî¨üéÆ`;
    if (navigator.share) {
        navigator.share({ text });
    } else {
        alert(text);
    }
}

// Audio functions
function initAudioContext() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
}

function toggleMusic() {
    initAudioContext();
    if (isMusicPlaying) {
        stopMusic();
        document.getElementById('musicIcon').textContent = 'üîá';
    } else {
        playBackgroundMusic();
        document.getElementById('musicIcon').textContent = 'üîä';
    }
}

function playBackgroundMusic() {
    if (!audioContext || isMusicPlaying) return;
    isMusicPlaying = true;

    const notes = [262, 294, 330, 349, 392, 440, 494, 523];
    let noteIndex = 0;

    function playNote() {
        if (!isMusicPlaying) return;

        const osc = audioContext.createOscillator();
        const gain = audioContext.createGain();
        osc.connect(gain);
        gain.connect(audioContext.destination);

        osc.frequency.value = notes[noteIndex];
        osc.type = 'sine';
        gain.gain.setValueAtTime(0.1, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

        osc.start();
        osc.stop(audioContext.currentTime + 0.5);
        currentOscillators.push(osc);

        noteIndex = (noteIndex + 1) % notes.length;
        setTimeout(playNote, 500);
    }

    playNote();
}

function stopMusic() {
    isMusicPlaying = false;
    currentOscillators.forEach(osc => {
        try { osc.stop(); } catch (e) {}
    });
    currentOscillators = [];
}

function playCollectSound() {
    if (!audioContext) return;

    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    osc.connect(gain);
    gain.connect(audioContext.destination);

    osc.frequency.value = 800;
    osc.type = 'square';
    gain.gain.setValueAtTime(0.2, audioContext.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);

    osc.start();
    osc.stop(audioContext.currentTime + 0.1);
}

// Keyboard controls
document.addEventListener('keydown', (e) => {
    if (e.key === 'p' || e.key === 'P') {
        togglePause();
        e.preventDefault();
        return;
    }

    if (gameLoopPaused || isPaused) return;

    if (e.key === 'ArrowUp' && dy === 0) {
        dx = 0; dy = -1;
    } else if (e.key === 'ArrowDown' && dy === 0) {
        dx = 0; dy = 1;
    } else if (e.key === 'ArrowLeft' && dx === 0) {
        dx = -1; dy = 0;
    } else if (e.key === 'ArrowRight' && dx === 0) {
        dx = 1; dy = 0;
    }

    e.preventDefault();
});
    </script>
</body>
</html>
